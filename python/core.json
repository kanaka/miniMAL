["do",

["def", "py-slice", "slice"],
["def", "py-apply", "apply"],
["def", "py-map", "map"],
["def", "py-list", "list"],
["def", ".", ["fn", ["a", "b", "&", "args"],
  ["py-apply", [".-", "a", "b"], "args"]]],
["def", "readline", "input"],

["def", "map", ["fn", ["a", "b"],
    ["py-apply", "py-list", ["py-map", "a", "b"]]]],
["def", ">=", ["fn", ["a", "b"],
  ["if", ["<", "a", "b"], false, true]]],
["def", ">", ["fn", ["a", "b"],
  ["if", [">=", "a", "b"],
    ["if", ["=", "a", "b"], false, true],
    false]]],
["def", "<=", ["fn", ["a", "b"],
  ["if", [">", "a", "b"], false, true]]],

["def", "classOf", ["fn", ["a"],
  [".-", ["type", "a"], ["`", "__name__"]]]],

["def", "not", ["fn", ["a"], ["if", "a", false, true]]],

["def", "null?", ["fn", ["a"], ["=", null, "a"]]],
["def", "true?", ["fn", ["a"], ["=", true, "a"]]],
["def", "false?", ["fn", ["a"], ["=", false, "a"]]],
["def", "string?", ["fn", ["a"],
  ["if", ["=", "a", null],
    false,
    ["=", ["type", "a"], ["type", ["`",  ""]]]]]],

["def", "pr-list*", ["fn", ["a", "b", "c"],
  ["let", ["lst", ["map", ["fn", ["x"],
                            ["if", "c",
                                ["pr*", "x"],
                                ["if", ["string?", "x"],
                                       "x",
                                       ["pr*", "x"]]]],
                          "a"]],
      [".", "b", ["`", "join"], "lst"]]]],
["def", "pr-str", ["fn", ["&", "a"],
  ["pr-list*", "a", ["`", " "], true]]],
["def", "str", ["fn", ["&", "a"],
  ["pr-list*", "a", ["`", ""], false]]],
["def", "prn", ["fn", ["&", "a"],
  ["print", ["pr-list*", "a", ["`", " "], true]]]],
["def", "println", ["fn", ["&", "a"],
  ["print", ["pr-list*", "a", ["`", " "], false]]]],

["def", "list?", ["fn", ["a"],
  ["=", ["type", ["list"]], ["type", "a"]]]],
["def", "contains?", ["fn", ["a", "b"],
  [".", "a", ["`", "__contains__"], "b"]]],
["def", "get", ["fn", ["a", "b"],
  [".", "a", ["`", "get"], "b", null]]],
["def", "set", ["fn", ["a", "b", "c"],
  ["do", [".", "a", ["`", "__setitem__"], "b", "c"], "a"]]],
["def", "keys", ["fn", ["a"],
  ["py-apply", "list", [".", "a", ["`", "keys"]]]]],
["def", "vals", ["fn", ["a"],
  ["py-apply", "list", [".", "a", ["`", "values"]]]]],

["def", "cons", ["fn", ["a", "b"],
  ["+", ["list", "a"], "b"]]],
["def", "concat", ["fn", ["&", "a"],
  [".", ["__import__", ["`", "functools"]], ["`", "reduce"],
   ["fn", ["x", "y"], ["+", "x", "y"]], "a"]]],
["def", "nth", ["fn", ["a", "b"],
  [".", "a", ["`", "__getitem__"], "b"]]],
["def", "count", ["fn", ["a"],
  ["len", "a"]]],
["def", "first", ["fn", ["a"],
  ["if", [">", ["count", "a"], 0],
    ["nth", "a", 0],
    null]]],
["def", "last", ["fn", ["a"],
  ["nth", "a", ["-", ["count", "a"], 1]]]],
["def", "empty?", ["fn", ["a"],
  ["if", ["list?", "a"],
    ["=", 0, ["count", "a"]],
    ["=", "a", null]]]],
["def", "slice", ["fn", ["a", "b", "&", "end"],
  [".", "a", ["`", "__getitem__"], ["py-slice", "b",
    ["if", [">", ["count", "end"], 0],
      [".", "end", ["`", "__getitem__"], 0],
      ["count", "a"]] ]]]],
["def", "rest", ["fn", ["a"], ["slice", "a", 1]]],

["def", "apply", ["fn", ["f", "&", "b"],
  ["py-apply", "f",
    ["concat", ["slice", "b", 0, -1], ["last", "b"]]]]],

["def", "and", ["~", ["fn", ["&", "xs"],
  ["if", ["empty?", "xs"],
    true,
    ["if", ["=", 1, ["count", "xs"]],
      ["first", "xs"],
      ["list", ["`", "let"], ["list", ["`", "__and"], ["first", "xs"]],
        ["list", ["`", "if"], ["`", "__and"],
          ["concat", ["`", ["and"]], ["rest", "xs"]],
          ["`", "__and"]]]]]]]],

["def", "or", ["~", ["fn", ["&", "xs"],
  ["if", ["empty?", "xs"],
    null,
    ["if", ["=", 1, ["count", "xs"]],
      ["first", "xs"],
      ["list", ["`", "let"], ["list", ["`", "or_FIXME"], ["first", "xs"]],
        ["list", ["`", "if"], ["`", "or_FIXME"],
          ["`", "or_FIXME"],
          ["concat", ["`", ["or"]], ["rest", "xs"]]]]]]]]],

null
]

